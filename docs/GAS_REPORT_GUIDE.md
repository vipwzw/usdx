# GasæŠ¥å‘Šç”Ÿæˆå™¨ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

æœ¬é¡¹ç›®åŒ…å«ä¸€ä¸ªä¸“é—¨çš„GasæŠ¥å‘Šç”Ÿæˆå™¨ï¼Œç”¨äºç”Ÿæˆæ¸…æ´ã€å¯è¯»çš„æ™ºèƒ½åˆçº¦Gasä½¿ç”¨æŠ¥å‘Šã€‚è¯¥å·¥å…·è§£å†³äº†ä¼ ç»Ÿhardhat gas-reporterè¾“å‡ºä¸­çš„ä¹±ç é—®é¢˜ï¼Œæä¾›äº†æ ¼å¼åŒ–çš„markdownè¡¨æ ¼è¾“å‡ºã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ”§ æ ¸å¿ƒåŠŸèƒ½
- **è‡ªåŠ¨æ¸…ç†ä¹±ç **: å»é™¤ANSIé¢œè‰²æ§åˆ¶å­—ç¬¦å’Œç‰¹æ®Šç¬¦å·
- **æ™ºèƒ½æ•°æ®æå–**: ä»æµ‹è¯•è¾“å‡ºä¸­å‡†ç¡®æå–gasä½¿ç”¨æ•°æ®
- **æ ¼å¼åŒ–è¾“å‡º**: ç”Ÿæˆæ ‡å‡†markdownè¡¨æ ¼æ ¼å¼
- **ä¸­æ–‡ç•Œé¢**: å‹å¥½çš„ä¸­æ–‡å­—æ®µåå’Œè¯´æ˜
- **åˆ†ç±»æ˜¾ç¤º**: åˆ†åˆ«æ˜¾ç¤ºæ–¹æ³•è°ƒç”¨å’Œéƒ¨ç½²gasæ¶ˆè€—

### ğŸ“Š æŠ¥å‘Šå†…å®¹
- **æ–¹æ³•è°ƒç”¨Gasæ¶ˆè€—**: æ¯ä¸ªåˆçº¦æ–¹æ³•çš„è¯¦ç»†gasç»Ÿè®¡
- **éƒ¨ç½²Gasæ¶ˆè€—**: åˆçº¦éƒ¨ç½²çš„gasä½¿ç”¨æƒ…å†µ
- **è¯¦ç»†è¯´æ˜**: å„å­—æ®µå«ä¹‰çš„è¯´æ˜

## ä½¿ç”¨æ–¹æ³•

### 1. æœ¬åœ°è¿è¡Œ

```bash
# è¿›å…¥contractsç›®å½•
cd contracts

# ç”ŸæˆgasæŠ¥å‘Š
npm run gas:report

# æˆ–è€…ç›´æ¥è¿è¡Œè„šæœ¬
node scripts/generate-gas-report.js
```

### 2. CI/CDè‡ªåŠ¨åŒ–

GasæŠ¥å‘Šç”Ÿæˆå™¨å·²ç»é›†æˆåˆ°GitHub Actionså·¥ä½œæµä¸­ï¼Œä¼šåœ¨æ¯æ¬¡PRæ—¶è‡ªåŠ¨ç”Ÿæˆå¹¶å‘å¸ƒgasæŠ¥å‘Šè¯„è®ºã€‚

## é…ç½®è¦æ±‚

### ä¾èµ–é¡¹
- Node.js >= 18.0.0
- Hardhat
- hardhat-gas-reporteræ’ä»¶

### ç¯å¢ƒå˜é‡
- `REPORT_GAS=true`: å¯ç”¨gasæŠ¥å‘Š
- `NO_COLOR=1`: ç¦ç”¨é¢œè‰²è¾“å‡º
- `FORCE_COLOR=0`: å¼ºåˆ¶ç¦ç”¨é¢œè‰²

## è¾“å‡ºæ ¼å¼

### ç¤ºä¾‹è¾“å‡º

```markdown
ğŸ“Š Gasä½¿ç”¨æŠ¥å‘Š

## ğŸ“‹ åˆçº¦æ–¹æ³•è°ƒç”¨Gasæ¶ˆè€—

| åˆçº¦           | æ–¹æ³•                                  | æœ€å°å€¼ | æœ€å¤§å€¼ | å¹³å‡å€¼ | è°ƒç”¨æ¬¡æ•° |
| -------------- | ------------------------------------- | ------ | ------ | ------ | -------- |
| USDXToken      | transfer(address,uint256)             | 71029  | 132042 | 100721 | 13       |
| USDXToken      | mint(address,uint256)                 | 72773  | 72785  | 72781  | 19       |
| USDXGovernance | propose(address,uint256,bytes,string) | 176709 | 244587 | 186382 | 38       |

## ğŸš€ åˆçº¦éƒ¨ç½²Gasæ¶ˆè€—

| åˆçº¦           | Gasæ¶ˆè€— | åŒºå—é™åˆ¶å æ¯” |
| -------------- | ------- | ------------ |
| USDXToken      | 3473876 | 28.9 %       |
| USDXGovernance | 2805836 | 23.4 %       |

## ğŸ“ è¯´æ˜
- **æœ€å°å€¼**: è¯¥æ–¹æ³•è°ƒç”¨çš„æœ€ä½gasæ¶ˆè€—
- **æœ€å¤§å€¼**: è¯¥æ–¹æ³•è°ƒç”¨çš„æœ€é«˜gasæ¶ˆè€—
- **å¹³å‡å€¼**: è¯¥æ–¹æ³•è°ƒç”¨çš„å¹³å‡gasæ¶ˆè€—
- **è°ƒç”¨æ¬¡æ•°**: æµ‹è¯•ä¸­è¯¥æ–¹æ³•çš„è°ƒç”¨æ¬¡æ•°
- **åŒºå—é™åˆ¶å æ¯”**: éƒ¨ç½²gaså åŒºå—gasé™åˆ¶çš„ç™¾åˆ†æ¯”
```

## è„šæœ¬ç»“æ„

### ä¸»è¦æ–‡ä»¶
- `contracts/scripts/generate-gas-report.js`: ä¸»è„šæœ¬æ–‡ä»¶
- `contracts/package.json`: åŒ…å«`gas:report`è„šæœ¬å‘½ä»¤
- `.github/workflows/ci.yml`: CI/CDé›†æˆé…ç½®

### æ ¸å¿ƒå‡½æ•°
- `generateGasReport()`: ä¸»ç”Ÿæˆå‡½æ•°
- `extractAndFormatGasReport()`: æå–å’Œæ ¼å¼åŒ–æ•°æ®
- `parseGasDataLines()`: è§£ægasæ•°æ®è¡Œ
- `formatGasReport()`: æ ¼å¼åŒ–è¾“å‡º
- `createFallbackReport()`: ç”Ÿæˆå¤‡ç”¨æŠ¥å‘Š

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**1. ç”Ÿæˆçš„æŠ¥å‘Šä¸ºç©º**
```bash
# æ£€æŸ¥æµ‹è¯•æ˜¯å¦æ­£å¸¸è¿è¡Œ
npm test

# æ£€æŸ¥gas reporteré…ç½®
grep -r "gas-reporter" hardhat.config.js
```

**2. æ•°æ®æ ¼å¼é”™è¯¯**
```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡
echo $REPORT_GAS

# æ‰‹åŠ¨è¿è¡Œæµ‹è¯•æŸ¥çœ‹åŸå§‹è¾“å‡º
REPORT_GAS=true npx hardhat test
```

**3. æƒé™é—®é¢˜**
```bash
# ç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™
chmod +x contracts/scripts/generate-gas-report.js
```

### è°ƒè¯•æ¨¡å¼

å¼€å‘è€…å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è°ƒè¯•è„šæœ¬ï¼š

```bash
# æŸ¥çœ‹åŸå§‹æµ‹è¯•è¾“å‡º
REPORT_GAS=true npx hardhat test > debug-output.txt

# æŸ¥çœ‹æ¸…ç†åçš„è¾“å‡º
node -e "
const fs = require('fs');
const content = fs.readFileSync('debug-output.txt', 'utf8');
const cleaned = content.replace(/\x1b\[[0-9;]*m/g, '');
fs.writeFileSync('debug-cleaned.txt', cleaned);
"
```

## è‡ªå®šä¹‰é…ç½®

### ä¿®æ”¹è¾“å‡ºæ ¼å¼

å¦‚éœ€è‡ªå®šä¹‰è¾“å‡ºæ ¼å¼ï¼Œå¯ä»¥ä¿®æ”¹`formatGasReport()`å‡½æ•°ä¸­çš„æ¨¡æ¿ï¼š

```javascript
// è‡ªå®šä¹‰è¡¨å¤´
const headers = ['Contract', 'Method', 'Gas Used', 'Calls'];

// è‡ªå®šä¹‰åˆ†éš”ç¬¦
const separator = '|---|---|---|---|';
```

### æ·»åŠ æ–°çš„æ•°æ®å­—æ®µ

åœ¨`parseGasDataLines()`å‡½æ•°ä¸­æ·»åŠ æ–°çš„å­—æ®µè§£æï¼š

```javascript
const item = {
  // ... existing fields
  newField: parts[7] || '',  // æ–°å­—æ®µ
};
```

## ç‰ˆæœ¬å†å²

- **v1.0.0**: åˆå§‹ç‰ˆæœ¬ï¼ŒåŸºæœ¬çš„gasæŠ¥å‘Šç”Ÿæˆ
- **v1.1.0**: æ·»åŠ ä¹±ç æ¸…ç†åŠŸèƒ½
- **v1.2.0**: å®Œå…¨é‡æ„ï¼Œæ”¯æŒmarkdownè¡¨æ ¼æ ¼å¼
- **v1.3.0**: æ·»åŠ ä¸­æ–‡ç•Œé¢å’Œè¯¦ç»†è¯´æ˜

## è´¡çŒ®æŒ‡å—

å¦‚éœ€æ”¹è¿›gasæŠ¥å‘Šç”Ÿæˆå™¨ï¼š

1. Forké¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. ä¿®æ”¹`contracts/scripts/generate-gas-report.js`
4. æ·»åŠ æµ‹è¯•ç”¨ä¾‹
5. æäº¤PR

## è®¸å¯è¯

MIT License - è¯¦è§é¡¹ç›®æ ¹ç›®å½•LICENSEæ–‡ä»¶ã€‚ 
